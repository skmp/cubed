-- Blue Rectangle 640x480 VGA Output
-- Renders a blue rectangle centered on a green background
-- using node 117's 9-bit DAC for VGA color output.
--
-- EVB001 hardware notes:
--   Node 117 has a 9-bit DAC (117.ao, pin 50 on host chip).
--   The DAC produces a single analog output voltage â€” not
--   separate R/G/B signals. On real hardware, external resistor
--   networks on the prototyping area split the DAC output into
--   R, G, B channels for the J70 VGA connector.
--   HSYNC/VSYNC are GPIO-driven from available node pins.
--
-- Emulator convention:
--   The emulator interprets IO register writes from DAC nodes
--   (117, 617, 717) as VGA pixel data:
--     bits [8:6] = R, [5:3] = G, [2:0] = B (512 colors)
--     bit 17 (0x20000) = HSYNC (end of scanline)
--     bit 16 (0x10000) = VSYNC (end of frame)
--
-- Color values:
--   Green: R=0, G=7, B=0 -> 0b000_111_000 = 56
--   Blue:  R=0, G=0, B=7 -> 0b000_000_111 = 7
--
-- Layout: 640x480 with centered 200x200 blue rectangle
--   Rows 0-139:   all green (640 px) + hsync
--   Rows 140-339: 220 green + 200 blue + 220 green + hsync
--   Rows 340-479: all green (640 px) + hsync
--   vsync at end of frame
--
-- Uses fill{} for tight pixel loops and loop{}/again{} for row loops.
-- B register defaults to 0x15D (IO port) on F18A reset.

node 117

/\

-- Top green margin: 140 rows of 640 green pixels
loop{n=140}
/\ fill{value=56, count=640}
/\ send{port=0x15D, value=0x20000}
/\ again{}

/\

-- Rectangle rows: 200 rows (220 green + 200 blue + 220 green)
loop{n=200}
/\ fill{value=56, count=220}
/\ fill{value=7, count=200}
/\ fill{value=56, count=220}
/\ send{port=0x15D, value=0x20000}
/\ again{}

/\

-- Bottom green margin: 140 rows of 640 green pixels
loop{n=140}
/\ fill{value=56, count=640}
/\ send{port=0x15D, value=0x20000}
/\ again{}

/\

-- End of frame
send{port=0x15D, value=0x10000}
