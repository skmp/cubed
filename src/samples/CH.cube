-- Swiss Flag (CH) 256x256 VGA Output (EVB002 3-node architecture)
-- Renders a simplified Swiss flag centered on a 640x480 framebuffer.
-- Red square with white horizontal bar (simplified cross pattern).
--
-- EVB002 VGA wiring:
--   Node 117 DAC (117.ao) -> R channel (J70 pin 1)
--   Node 617 DAC (617.ao) -> G channel (J70 pin 2)
--   Node 717 DAC (717.ao) -> B channel (J70 pin 3)
--   Node 217 pin17 (GPIO) -> HSYNC (J70 pin 4) / VSYNC (J70 pin 5)
--
-- DAC XOR encoding: write (desired ^ 0x155) to IO register.
--   Zero output:  0x000 ^ 0x155 = 0x155
--   Max output:   0x1FF ^ 0x155 = 0x0AA
--
-- Layout (absolute coordinates, 640x480):
--   Flag: 256x256 at (192,112)-(447,367)
--   Rows 0-111:   black (112 rows)
--   Rows 112-207: red only (96 rows, flag top)
--   Rows 208-271: white bar (64 rows, cross center)
--   Rows 272-367: red only (96 rows, flag bottom)
--   Rows 368-479: black (112 rows)

-- ============================================================
-- RED CHANNEL (node 117 DAC)
-- ============================================================
-- R is max (0x0AA) for both red and white areas, zero (0x155) for black.

node 117

/\

-- Black above flag: 112 rows
loop{n=112}
/\ fill{value=0x155, count=640}
/\ again{}

/\

-- Flag rows: 256 rows (R=max for entire flag area)
loop{n=256}
/\ fill{value=0x155, count=192}
/\ fill{value=0x0AA, count=256}
/\ fill{value=0x155, count=192}
/\ again{}

/\

-- Black below flag: 112 rows
loop{n=112}
/\ fill{value=0x155, count=640}
/\ again{}

-- ============================================================
-- GREEN CHANNEL (node 617 DAC)
-- ============================================================
-- G is max (0x0AA) for white bar only, zero (0x155) everywhere else.

node 617

/\

-- Black + red top: 208 rows (112 black + 96 red)
loop{n=208}
/\ fill{value=0x155, count=640}
/\ again{}

/\

-- White bar rows: 64 rows
-- 192 black + 48 red + 160 white + 48 red + 192 black
loop{n=64}
/\ fill{value=0x155, count=240}
/\ fill{value=0x0AA, count=160}
/\ fill{value=0x155, count=240}
/\ again{}

/\

-- Red bottom + black: 208 rows (96 red + 112 black)
loop{n=208}
/\ fill{value=0x155, count=640}
/\ again{}

-- ============================================================
-- BLUE CHANNEL (node 717 DAC)
-- ============================================================
-- B is identical to G: max for white bar, zero everywhere else.

node 717

/\

-- Black + red top: 208 rows
loop{n=208}
/\ fill{value=0x155, count=640}
/\ again{}

/\

-- White bar rows: 64 rows
loop{n=64}
/\ fill{value=0x155, count=240}
/\ fill{value=0x0AA, count=160}
/\ fill{value=0x155, count=240}
/\ again{}

/\

-- Red bottom + black: 208 rows
loop{n=208}
/\ fill{value=0x155, count=640}
/\ again{}

-- ============================================================
-- SYNC SIGNALS (node 217 pin17 GPIO)
-- ============================================================
-- HSYNC after each row, VSYNC at end of frame.

node 217

/\

-- 480 rows: delay to match DAC timing, then send HSYNC
-- delay{n=641} balances timing between single-fill rows (2569 steps)
-- and triple-fill rows (2583 steps): sync row = 4*641+12 = 2576 steps.
loop{n=480}
/\ delay{n=641}
/\ send{port=0x15D, value=0x20000}
/\ again{}

/\

-- End of frame: VSYNC
send{port=0x15D, value=0x30000}
