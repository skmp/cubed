-- French Flag (FR) VGA Output (EVB002 7-node architecture)
-- Renders the French tricolour on a 640x480 framebuffer.
-- Three vertical stripes: blue (left), white (center), red (right).
--
-- Architecture: feeder-std.relay pipeline (same as CH.cube / PS.cube).
--   Feeder nodes (116, 616, 716) generate pixel data via std.fill{}
--   with B redirected to the east port (RIGHT=0x1D5 for even-x nodes).
--   DAC std.relay nodes (117, 617, 717) read from west and write to IO.
--   R std.relay (117) signals sync node (217) after each row for HSYNC.
--
-- Flag layout (640x480, full frame):
--   Blue stripe:  columns 0-213   (214 px)
--   White stripe: columns 214-426 (213 px)
--   Red stripe:   columns 427-639 (213 px)
--
-- Color breakdown per channel:
--   R: blue=0, white=max, red=max  -> 214 zero + 213 max + 213 max
--   G: blue=0, white=max, red=0    -> 214 zero + 213 max + 213 zero
--   B: blue=max, white=max, red=0  -> 214 max  + 213 max + 213 zero
--
-- IMPORTANT: All three feeders must have the same number of std.fill{}
-- calls per row so they stay in sync (each std.fill{} compiles to a std.loop
-- with overhead, so mismatched counts cause channel drift).
--
-- DAC XOR encoding:
--   Zero output: 0x155, Max output: 0x0AA

-- ============================================================
-- RED DAC RELAY (node 117)
-- ============================================================

#include std

/\

node 117

/\

std.loop{n=480}
/\ std.relay{port=0x1D5, count=640}
/\ std.send{port=0x145, value=0}
/\ std.again{}

-- ============================================================
-- GREEN DAC RELAY (node 617)
-- ============================================================

node 617

/\

std.loop{n=480}
/\ std.relay{port=0x1D5, count=640}
/\ std.again{}

-- ============================================================
-- BLUE DAC RELAY (node 717)
-- ============================================================

node 717

/\

std.loop{n=480}
/\ std.relay{port=0x1D5, count=640}
/\ std.again{}

-- ============================================================
-- RED FEEDER (node 116)
-- ============================================================
-- R = 0 for blue stripe, max for white + red stripes.
-- Split into 3 fills to match green feeder's 3 fills per row.

node 116 { b=0x1D5 }

/\

std.loop{n=480}
/\ std.fill{value=0x155, count=214}
/\ std.fill{value=0x0AA, count=213}
/\ std.fill{value=0x0AA, count=213}
/\ std.again{}

-- ============================================================
-- GREEN FEEDER (node 616)
-- ============================================================
-- G = 0 for blue stripe, max for white, 0 for red.

node 616 { b=0x1D5 }

/\

std.loop{n=480}
/\ std.fill{value=0x155, count=214}
/\ std.fill{value=0x0AA, count=213}
/\ std.fill{value=0x155, count=213}
/\ std.again{}

-- ============================================================
-- BLUE FEEDER (node 716)
-- ============================================================
-- B = max for blue + white stripes, 0 for red.
-- Split into 3 fills to match green feeder's 3 fills per row.

node 716 { b=0x1D5 }

/\

std.loop{n=480}
/\ std.fill{value=0x0AA, count=214}
/\ std.fill{value=0x0AA, count=213}
/\ std.fill{value=0x155, count=213}
/\ std.again{}

-- ============================================================
-- SYNC SIGNALS (node 217 pin17 GPIO)
-- ============================================================

node 217

/\

std.loop{n=480}
/\ std.recv{port=0x145}
/\ std.send{port=0x15D, value=0x20000}
/\ std.again{}

/\

-- End of frame: VSYNC
std.send{port=0x15D, value=0x30000}
