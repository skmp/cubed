-- Dutch Flag (NL) VGA Output (EVB002 7-node architecture)
-- Renders the flag of the Netherlands on a 640x480 framebuffer.
-- Three horizontal stripes: red (top), white (middle), blue (bottom).
--
-- Architecture: feeder-std.relay pipeline (same as FR.cube / CH.cube / PS.cube).
--   Feeder nodes (116, 616, 716) generate pixel data via std.fill{}
--   with B redirected to the east port (RIGHT=0x1D5 for even-x nodes).
--   DAC std.relay nodes (117, 617, 717) read from west and write to IO.
--   R std.relay (117) signals sync node (217) after each row for HSYNC.
--
-- Flag layout (640x480, full frame):
--   Red stripe:   rows 0-159   (160 rows)
--   White stripe: rows 160-319 (160 rows)
--   Blue stripe:  rows 320-479 (160 rows)
--
-- Color breakdown per channel:
--   R: red=max, white=max, blue=0    -> 160 rows max + 160 rows max + 160 rows zero
--   G: red=0,   white=max, blue=0    -> 160 rows zero + 160 rows max + 160 rows zero
--   B: red=0,   white=max, blue=max  -> 160 rows zero + 160 rows max + 160 rows max
--
-- DAC XOR encoding:
--   Zero output: 0x155, Max output: 0x0AA

-- ============================================================
-- RED DAC RELAY (node 117)
-- ============================================================

#include std

/\

node 117

/\

std.loop{n=480}
/\ std.relay{port=0x1D5, count=640}
/\ std.send{port=0x145, value=0}
/\ std.again{}

-- ============================================================
-- GREEN DAC RELAY (node 617)
-- ============================================================

node 617

/\

std.loop{n=480}
/\ std.relay{port=0x1D5, count=640}
/\ std.again{}

-- ============================================================
-- BLUE DAC RELAY (node 717)
-- ============================================================

node 717

/\

std.loop{n=480}
/\ std.relay{port=0x1D5, count=640}
/\ std.again{}

-- ============================================================
-- RED FEEDER (node 116)
-- ============================================================
-- R = max for red + white stripes, 0 for blue stripe.

node 116

/\

std.setb{addr=0x1D5}

/\

-- Red stripe (top): R = max
std.loop{n=160}
/\ std.fill{value=0x0AA, count=640}
/\ std.again{}

/\

-- White stripe (middle): R = max
std.loop{n=160}
/\ std.fill{value=0x0AA, count=640}
/\ std.again{}

/\

-- Blue stripe (bottom): R = 0
std.loop{n=160}
/\ std.fill{value=0x155, count=640}
/\ std.again{}

-- ============================================================
-- GREEN FEEDER (node 616)
-- ============================================================
-- G = 0 for red, max for white, 0 for blue.

node 616

/\

std.setb{addr=0x1D5}

/\

-- Red stripe (top): G = 0
std.loop{n=160}
/\ std.fill{value=0x155, count=640}
/\ std.again{}

/\

-- White stripe (middle): G = max
std.loop{n=160}
/\ std.fill{value=0x0AA, count=640}
/\ std.again{}

/\

-- Blue stripe (bottom): G = 0
std.loop{n=160}
/\ std.fill{value=0x155, count=640}
/\ std.again{}

-- ============================================================
-- BLUE FEEDER (node 716)
-- ============================================================
-- B = 0 for red, max for white + blue stripes.

node 716

/\

std.setb{addr=0x1D5}

/\

-- Red stripe (top): B = 0
std.loop{n=160}
/\ std.fill{value=0x155, count=640}
/\ std.again{}

/\

-- White stripe (middle): B = max
std.loop{n=160}
/\ std.fill{value=0x0AA, count=640}
/\ std.again{}

/\

-- Blue stripe (bottom): B = max
std.loop{n=160}
/\ std.fill{value=0x0AA, count=640}
/\ std.again{}

-- ============================================================
-- SYNC SIGNALS (node 217 pin17 GPIO)
-- ============================================================

node 217

/\

std.loop{n=480}
/\ std.recv{port=0x145}
/\ std.send{port=0x15D, value=0x20000}
/\ std.again{}

/\

-- End of frame: VSYNC
std.send{port=0x15D, value=0x30000}
