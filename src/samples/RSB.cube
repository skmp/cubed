-- RSB: Runtime Shor's Algorithm — Serial Boot Output via Node 708
-- Same as RSA but routes Shor's results to node 708 (async serial TX)
-- instead of node 317 (IO register capture).
--
-- After boot, node 708 receives the 5 result values from the relay
-- chain (417 → 317 → 308 → 408 → 508 → 608 → 708) and writes each
-- to its IO register — the async serial TX pin — so results are
-- continuously transmitted over the same serial port used for booting.
--
-- Architecture: 7 declared nodes + wire relay chain
--   VGA: 117 (R delta), 617 (G delta), 717 (B delta), 217 (sync)
--   Compute: 416 (noise counter) → 417 (Shor's algorithm)
--   Serial: 317 308 408 508 608 (wire relays) → 708 (async serial TX)

-- ============================================================
-- RED DAC — DELTA VCO (node 117, analog)
-- ============================================================

node 117

/\

loop{n=480}
/\ deltarelay{port=0x141, count=640}
/\ send{port=0x145, value=0}
/\ again{}

-- ============================================================
-- GREEN DAC — DELTA VCO (node 617, analog)
-- ============================================================

node 617

/\

loop{n=480}
/\ deltarelay{port=0x141, count=640}
/\ again{}

-- ============================================================
-- BLUE DAC — DELTA VCO (node 717, analog)
-- ============================================================

node 717

/\

loop{n=480}
/\ deltarelay{port=0x141, count=640}
/\ again{}

-- ============================================================
-- SYNC SIGNALS (node 217 pin17 GPIO)
-- ============================================================

node 217

/\

loop{n=480}
/\ recv{port=0x145}
/\ send{port=0x15D, value=0x20000}
/\ again{}

/\

-- End of frame: VSYNC
send{port=0x15D, value=0x30000}

-- ============================================================
-- NOISE COUNTER (node 416 — free-running)
-- ============================================================
-- Increments a counter and sends it east to node 417.
-- The send blocks until 417 reads; thermal timing jitter means
-- the counter value at each read is nondeterministic.

node 416

/\

x = 0

/\

loop{n=32767}
/\ plus{a=x, b=1, c=x}
/\ send{port=0x1D5, value=x}
/\ again{}

-- ============================================================
-- SHOR'S COMPUTE (node 417 — 1-pin GPIO)
-- ============================================================
-- Reads noise from west (node 416), computes Shor's factoring
-- of N=15, sends results south toward node 317 (relay chain
-- continues to node 708 for async serial TX).
-- out_port=0x145: node 417 is even-y (y=4), south→UP=0x145.

node 417

/\

shor15{noise_port=0x1D5, out_port=0x145}

-- ============================================================
-- ASYNC SERIAL TX (node 708 — boot node)
-- ============================================================
-- Receives 5 result words from the relay chain via south port
-- (node 708 is odd-y (y=7), south→DOWN=0x115) and writes each
-- to the IO register (async serial TX pin).
-- Values: N=15, a, r, p, q — transmitted continuously.

node 708

/\

loop{n=32767}
/\ relay{port=0x115, count=5}
/\ again{}
