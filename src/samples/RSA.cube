-- RSA: Runtime Shor's Algorithm — Delta VCO Noise Visualization
-- Each DAC node (117, 617, 717) reads its own VCO counter via the
-- DATA port (0x141) and outputs the difference from the previous
-- reading. Each analog node has a physically distinct VCO circuit
-- with unique phase characteristics, producing independent noise
-- on the R, G, and B channels.
--
-- Also runs Shor's factoring algorithm for N=15 using VCO thermal
-- noise for random base selection.
--
-- Architecture: 7 nodes
--   VGA: 117 (R delta), 617 (G delta), 717 (B delta), 217 (sync)
--   Compute: 416 (noise counter) → 417 (Shor's algorithm)
--   Serial: 317 (IO output)

-- ============================================================
-- RED DAC — DELTA VCO (node 117, analog)
-- ============================================================

#include std

/\

node 117

/\

std.loop{n=480}
/\ std.deltarelay{port=0x141, count=640}
/\ std.send{port=0x145, value=0}
/\ std.again{}

-- ============================================================
-- GREEN DAC — DELTA VCO (node 617, analog)
-- ============================================================

node 617

/\

std.loop{n=480}
/\ std.deltarelay{port=0x141, count=640}
/\ std.again{}

-- ============================================================
-- BLUE DAC — DELTA VCO (node 717, analog)
-- ============================================================

node 717

/\

std.loop{n=480}
/\ std.deltarelay{port=0x141, count=640}
/\ std.again{}

-- ============================================================
-- SYNC SIGNALS (node 217 pin17 GPIO)
-- ============================================================

node 217

/\

std.loop{n=480}
/\ std.recv{port=0x145}
/\ std.send{port=0x15D, value=0x20000}
/\ std.again{}

/\

-- End of frame: VSYNC
std.send{port=0x15D, value=0x30000}

-- ============================================================
-- NOISE COUNTER (node 416 — free-running)
-- ============================================================
-- Increments a counter and sends it east to node 417.
-- The std.send blocks until 417 reads; thermal timing jitter means
-- the counter value at each read is nondeterministic.

node 416

/\

x = 0

/\

std.loop{n=32767}
/\ std.plus{a=x, b=1, c=x}
/\ std.send{port=0x1D5, value=x}
/\ std.again{}

-- ============================================================
-- SHOR'S COMPUTE (node 417 — 1-pin GPIO)
-- ============================================================
-- Reads noise from west (node 416), computes Shor's factoring
-- of N=15, sends results south to node 317 for serial output.

node 417

/\

std.shor15{noise_port=0x1D5, out_port=0x145}

-- ============================================================
-- SERIAL OUTPUT (node 317 — 1-pin GPIO)
-- ============================================================
-- Relays 5 values from north (node 417) to IO register.
-- Values: N=15, a, r, p, q — captured by emulator ring buffer.

node 317

/\

std.loop{n=32767}
/\ std.relay{port=0x145, count=5}
/\ std.again{}
